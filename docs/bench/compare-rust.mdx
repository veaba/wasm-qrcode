# Rust QRCode æ€§èƒ½æ¯”è¾ƒ

import { useState } from 'react';

export const RustBenchmarkChart = () => {
  const data = [
    { name: 'å•æ¡ç”Ÿæˆ', time: 57.8 },
    { name: 'SVG ç”Ÿæˆ', time: 44.9 },
    { name: 'æ‰¹é‡ 100', time: 4390 },
  ];

  const maxTime = Math.max(...data.map(d => d.time));
  const barHeight = 40;
  const gap = 20;
  const chartHeight = data.length * (barHeight + gap) + 40;

  return (
    <div style={{ marginBottom: '2rem' }}>
      <h3 style={{ textAlign: 'center', marginBottom: '1rem' }}>@veaba/qrcode-rust æ€§èƒ½æŒ‡æ ‡</h3>
      <svg width="100%" height={chartHeight} viewBox={`0 0 600 ${chartHeight}`}>
        {data.map((item, index) => {
          const y = index * (barHeight + gap) + 30;
          const barWidth = (item.time / maxTime) * 400;
          
          return (
            <g key={item.name}>
              <text x={0} y={y + barHeight / 2 + 5} fontSize={14} fill="#374151">
                {item.name}
              </text>
              <rect
                x={100}
                y={y}
                width={barWidth}
                height={barHeight}
                fill="#dea584"
                rx={4}
              />
              <text x={110 + barWidth} y={y + barHeight / 2 + 5} fontSize={14} fill="#374151">
                {item.time < 1000 ? `${item.time} Âµs` : `${(item.time / 1000).toFixed(2)} ms`}
              </text>
            </g>
          );
        })}
      </svg>
    </div>
  );
};

export const ErrorLevelChart = () => {
  const data = [
    { name: 'L (ä½)', time: 36.6 },
    { name: 'M (ä¸­)', time: 36.7 },
    { name: 'Q (è¾ƒé«˜)', time: 32.8 },
    { name: 'H (é«˜)', time: 33.3 },
  ];

  const maxTime = Math.max(...data.map(d => d.time));

  return (
    <div style={{ marginBottom: '2rem' }}>
      <h3 style={{ textAlign: 'center', marginBottom: '1rem' }}>ä¸åŒçº é”™çº§åˆ«æ€§èƒ½</h3>
      <div style={{ display: 'flex', alignItems: 'flex-end', justifyContent: 'center', gap: '2rem', height: '200px', padding: '1rem' }}>
        {data.map((item) => (
          <div key={item.name} style={{ display: 'flex', flexDirection: 'column', alignItems: 'center' }}>
            <div style={{ fontSize: '12px', marginBottom: '0.5rem', color: '#64748b' }}>
              {item.time} Âµs
            </div>
            <div
              style={{
                width: '60px',
                height: `${(item.time / maxTime) * 150}px`,
                backgroundColor: '#dea584',
                borderRadius: '4px 4px 0 0',
                transition: 'height 0.3s ease'
              }}
            />
            <div style={{ marginTop: '0.5rem', fontSize: '14px', fontWeight: 500 }}>
              {item.name}
            </div>
          </div>
        ))}
      </div>
    </div>
  );
};

export const FeatureComparisonTable = () => {
  const features = [
    { name: 'SVG è¾“å‡º', veaba: true, kennytm: true },
    { name: 'PNG è¾“å‡º', veaba: true, kennytm: true },
    { name: 'å­—ç¬¦ä¸²è¾“å‡º', veaba: true, kennytm: true },
    { name: 'è‡ªå®šä¹‰æ ·å¼', veaba: 'å®Œæ•´', kennytm: 'æœ‰é™' },
    { name: 'çº é”™çº§åˆ« L/M/Q/H', veaba: true, kennytm: true },
    { name: 'å¼‚æ­¥æ”¯æŒ', veaba: true, kennytm: false },
    { name: 'WASM æ”¯æŒ', veaba: true, kennytm: false },
    { name: 'Node.js ç»‘å®š', veaba: 'è®¡åˆ’ä¸­', kennytm: false },
  ];

  return (
    <table style={{ width: '100%', borderCollapse: 'collapse', marginTop: '1rem' }}>
      <thead>
        <tr style={{ backgroundColor: '#f3f4f6' }}>
          <th style={{ padding: '12px', textAlign: 'left', borderBottom: '2px solid #e5e7eb' }}>åŠŸèƒ½</th>
          <th style={{ padding: '12px', textAlign: 'center', borderBottom: '2px solid #e5e7eb' }}>@veaba/qrcode-rust</th>
          <th style={{ padding: '12px', textAlign: 'center', borderBottom: '2px solid #e5e7eb' }}>kennytm-qrcode</th>
        </tr>
      </thead>
      <tbody>
        {features.map((f, i) => (
          <tr key={f.name} style={{ backgroundColor: i % 2 === 0 ? 'white' : '#f9fafb' }}>
            <td style={{ padding: '12px', borderBottom: '1px solid #e5e7eb' }}>{f.name}</td>
            <td style={{ padding: '12px', textAlign: 'center', borderBottom: '1px solid #e5e7eb' }}>
              {typeof f.veaba === 'boolean' ? (
                f.veaba ? <span style={{ color: '#22c55e', fontSize: '20px' }}>âœ“</span> : <span style={{ color: '#ef4444' }}>âœ—</span>
              ) : (
                <span style={{ color: f.veaba === 'å®Œæ•´' ? '#22c55e' : '#f59e0b', fontWeight: 500 }}>{f.veaba}</span>
              )}
            </td>
            <td style={{ padding: '12px', textAlign: 'center', borderBottom: '1px solid #e5e7eb' }}>
              {typeof f.kennytm === 'boolean' ? (
                f.kennytm ? <span style={{ color: '#22c55e', fontSize: '20px' }}>âœ“</span> : <span style={{ color: '#ef4444' }}>âœ—</span>
              ) : (
                <span style={{ color: '#f59e0b', fontWeight: 500 }}>{f.kennytm}</span>
              )}
            </td>
          </tr>
        ))}
      </tbody>
    </table>
  );
};

export const OptimizationCard = () => {
  const [activeTab, setActiveTab] = useState('algorithm');
  
  const tabs = {
    algorithm: {
      title: 'ç®—æ³•ä¼˜åŒ–',
      content: 'ä½¿ç”¨æ›´å¿«çš„ç¼–ç ç®—æ³•ï¼Œå‡å°‘è®¡ç®—æ­¥éª¤ï¼Œä¼˜åŒ–ä½è¿ç®—æ“ä½œ',
      improvement: '~25%'
    },
    memory: {
      title: 'å†…å­˜ä¼˜åŒ–',
      content: 'å‡å°‘ä¸å¿…è¦çš„å†…å­˜åˆ†é…ï¼Œä½¿ç”¨å¯¹è±¡æ± å¤ç”¨å†…å­˜ï¼Œä¼˜åŒ–æ•°æ®ç»“æ„å¸ƒå±€',
      improvement: '~20%'
    },
    simd: {
      title: 'SIMD æ”¯æŒ',
      content: 'åˆ©ç”¨ CPU å‘é‡æŒ‡ä»¤åŠ é€ŸçŸ©é˜µè¿ç®—å’Œå›¾åƒå¤„ç†',
      improvement: '~40% (ç‰¹å®šåœºæ™¯)'
    }
  };

  return (
    <div style={{ padding: '1.5rem', backgroundColor: '#f8fafc', borderRadius: '8px', marginTop: '1.5rem' }}>
      <h3 style={{ marginTop: 0 }}>ğŸš€ @veaba/qrcode-fast ä¼˜åŒ–ç‰¹æ€§</h3>
      
      <div style={{ display: 'flex', gap: '0.5rem', marginBottom: '1.5rem', flexWrap: 'wrap' }}>
        {Object.entries(tabs).map(([key, tab]) => (
          <button
            key={key}
            onClick={() => setActiveTab(key)}
            style={{
              padding: '0.5rem 1rem',
              borderRadius: '6px',
              border: 'none',
              cursor: 'pointer',
              backgroundColor: activeTab === key ? '#dea584' : '#e2e8f0',
              color: activeTab === key ? 'white' : '#475569',
              fontWeight: activeTab === key ? 600 : 400,
              transition: 'all 0.2s'
            }}
          >
            {tab.title}
          </button>
        ))}
      </div>

      <div style={{ 
        padding: '1.5rem', 
        backgroundColor: 'white', 
        borderRadius: '8px',
        borderLeft: '4px solid #dea584'
      }}>
        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '0.5rem' }}>
          <div style={{ fontSize: '18px', fontWeight: 600 }}>{tabs[activeTab].title}</div>
          <div style={{ 
            padding: '4px 12px', 
            backgroundColor: '#dcfce7', 
            color: '#166534',
            borderRadius: '12px',
            fontSize: '14px',
            fontWeight: 600
          }}>
            æå‡ {tabs[activeTab].improvement}
          </div>
        </div>
        <div style={{ fontSize: '14px', color: '#475569', lineHeight: 1.6 }}>
          {tabs[activeTab].content}
        </div>
      </div>
    </div>
  );
};

## æµ‹è¯•ç¯å¢ƒ

- **å¹³å°**: Windows
- **Rust**: æœ€æ–°ç¨³å®šç‰ˆ
- **æµ‹è¯•æ—¶é—´**: 2026-02-01

## æ¯”è¾ƒçš„åŒ…

- `@veaba/qrcode-rust` - æœ¬é¡¹ç›® Rust å®ç°
- `kennytm-qrcode` - æµè¡Œçš„ Rust QRCode åº“ï¼ˆä½œä¸ºåŸºå‡†ï¼‰

---

## ğŸ“Š æ€§èƒ½å¯è§†åŒ–

### @veaba/qrcode-rust æ€§èƒ½æŒ‡æ ‡

<RustBenchmarkChart />

### ä¸åŒçº é”™çº§åˆ«æ€§èƒ½

<ErrorLevelChart />

---

## ğŸ“‹ åŠŸèƒ½å¯¹æ¯”

<FeatureComparisonTable />

---

## ğŸš€ ä¼˜åŒ–ç‰ˆæœ¬

<OptimizationCard />

---

## æ€§èƒ½æµ‹è¯•ç»“æœ

### @veaba/qrcode-rust åŸºå‡†æµ‹è¯•

åŸºäº `criterion` åŸºå‡†æµ‹è¯•æ¡†æ¶çš„ç»“æœï¼š

| æµ‹è¯•é¡¹ | å¹³å‡æ—¶é—´ | ååé‡ |
|--------|----------|--------|
| å•æ¡ç”Ÿæˆ | ~57.8 Âµs | ~17,300 ops/s |
| æ‰¹é‡ç”Ÿæˆ (100æ¡) | ~4.39 ms | ~22,780 ops/s |
| SVG ç”Ÿæˆ | ~44.9 Âµs | ~22,270 ops/s |

### çº é”™çº§åˆ«æ€§èƒ½

| çº é”™çº§åˆ« | å¹³å‡æ—¶é—´ | ç›¸å¯¹æ€§èƒ½ |
|----------|----------|----------|
| L (ä½) | ~36.6 Âµs | è¾ƒå¿« |
| M (ä¸­) | ~36.7 Âµs | è¾ƒå¿« |
| Q (è¾ƒé«˜) | ~32.8 Âµs | æœ€å¿« |
| H (é«˜) | ~33.3 Âµs | æœ€å¿« |

*æ³¨ï¼šQ å’Œ H çº§åˆ«åœ¨æŸäº›æµ‹è¯•åœºæ™¯ä¸‹è¡¨ç°æ›´å¥½ï¼Œå¯èƒ½ä¸æµ‹è¯•æ•°æ®ç‰¹å¾æœ‰å…³*

## ä¸ kennytm-qrcode çš„æ¯”è¾ƒ

### æ€§èƒ½å¯¹æ¯”

åŸºäºåŸºå‡†æµ‹è¯•çš„åˆæ­¥ç»“æœï¼š

```
@veaba/qrcode-rust:
- å•æ¡ç”Ÿæˆ: ~57.8 Âµs
- SVG ç”Ÿæˆ: ~44.9 Âµs
- æ‰¹é‡ 100 æ¡: ~4.39 ms
```

### ä¼˜åŒ–æ•ˆæœ

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å (@veaba/qrcode-fast) | æå‡ |
|------|--------|----------------------------|------|
| å•æ¡ç”Ÿæˆ | ~60 Âµs | ~45 Âµs | ~25% |
| æ‰¹é‡ç”Ÿæˆ | ~5 ms | ~4 ms | ~20% |

## ä½¿ç”¨å»ºè®®

| åœºæ™¯ | æ¨èåŒ… | åŸå›  |
|------|--------|------|
| é€šç”¨åœºæ™¯ | `@veaba/qrcode-rust` | åŠŸèƒ½å®Œæ•´ï¼Œæ€§èƒ½è‰¯å¥½ |
| æè‡´æ€§èƒ½ | `@veaba/qrcode-fast` | é’ˆå¯¹æ€§èƒ½ä¼˜åŒ– |
| å…¼å®¹æ€§ä¼˜å…ˆ | `kennytm-qrcode` | ç¤¾åŒºæˆç†Ÿï¼Œæ–‡æ¡£ä¸°å¯Œ |
| WASM åœºæ™¯ | `@veaba/qrcode-rust` | å†…ç½® WASM æ”¯æŒ |

## è¿è¡ŒåŸºå‡†æµ‹è¯•

```bash
# è¿è¡Œ Rust åŸºå‡†æµ‹è¯•
cd packages/qrcode-rust
cargo bench

# æŸ¥çœ‹è¯¦ç»†æŠ¥å‘Š
target/criterion/report/index.html
```

## è¯¦ç»†æŠ¥å‘Šä½ç½®

åŸºå‡†æµ‹è¯•çš„è¯¦ç»†æŠ¥å‘Šç”Ÿæˆåœ¨ï¼š
- `packages/qrcode-rust/target/criterion/`

å¯ä»¥ä½¿ç”¨æµè§ˆå™¨æ‰“å¼€æŸ¥çœ‹å›¾è¡¨å’Œè¯¦ç»†åˆ†æï¼š
```bash
# åœ¨ Windows ä¸Š
start packages/qrcode-rust/target/criterion/report/index.html
```

## æŠ€æœ¯ç»†èŠ‚

### æµ‹è¯•æ–¹æ³•

ä½¿ç”¨ Criterion.rs è¿›è¡ŒåŸºå‡†æµ‹è¯•ï¼š
- é¢„çƒ­æ—¶é—´: 3 ç§’
- é‡‡æ ·æ¬¡æ•°: 100 æ¬¡
- æµ‹é‡æ—¶é—´: çº¦ 5 ç§’/æµ‹è¯•

### æµ‹è¯•æ•°æ®

- çŸ­æ–‡æœ¬: `"https://example.com"`
- ä¸­ç­‰æ–‡æœ¬: `"https://github.com/veaba/qrcodes"`
- é•¿æ–‡æœ¬: åŒ…å«å¤šä¸ªå‚æ•°çš„ URL

---

*æ•°æ®æ–‡ä»¶*: [benchmark_rust_result.json](/benchmark_rust_result.json)

*æµ‹è¯•ä»£ç *: `packages/qrcode-rust/benches/comparison_bench.rs`

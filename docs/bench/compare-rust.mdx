# Rust QRCode æ€§èƒ½æ¯”è¾ƒ

import { useState } from 'react';

export const RustBenchmarkChart = () => {
  const data = [
    { name: 'å•æ¡ç”Ÿæˆ', veaba: 54.4, kennytm: 454.6 },
    { name: 'SVG ç”Ÿæˆ', veaba: 35.9, kennytm: 4.1 },
    { name: 'æ‰¹é‡ 100', veaba: 4213.1, kennytm: 34115.0 },
  ];

  const maxTime = Math.max(...data.map(d => Math.max(d.veaba, d.kennytm)));
  const barHeight = 40;
  const gap = 20;
  const chartHeight = data.length * (barHeight + gap) * 2 + 60;

  return (
    <div style={{ marginBottom: '2rem' }}>
      <h3 style={{ textAlign: 'center', marginBottom: '1rem' }}>æ€§èƒ½å¯¹æ¯” (Âµs/op) - è¶Šä½è¶Šå¥½</h3>
      <svg width="100%" height={chartHeight} viewBox={`0 0 700 ${chartHeight}`}>
        {data.map((item, index) => {
          const y = index * (barHeight + gap) * 2 + 40;
          const veabaWidth = (item.veaba / maxTime) * 400;
          const kennytmWidth = (item.kennytm / maxTime) * 400;
          
          return (
            <g key={item.name}>
              <text x={0} y={y + barHeight / 2 + 5} fontSize={14} fill="#374151">
                {item.name}
              </text>
              {/* @veaba bar */}
              <rect
                x={100}
                y={y}
                width={veabaWidth}
                height={barHeight}
                fill="#dea584"
                rx={4}
              />
              <text x={110 + veabaWidth} y={y + barHeight / 2 + 5} fontSize={12} fill="#374151">
                {item.veaba < 1000 ? `${item.veaba} Âµs` : `${(item.veaba / 1000).toFixed(2)} ms`}
              </text>
              {/* kennytm bar */}
              <rect
                x={100}
                y={y + barHeight + 5}
                width={kennytmWidth}
                height={barHeight}
                fill="#6b7280"
                rx={4}
              />
              <text x={110 + kennytmWidth} y={y + barHeight + 5 + barHeight / 2 + 5} fontSize={12} fill="#374151">
                {item.kennytm < 1000 ? `${item.kennytm} Âµs` : `${(item.kennytm / 1000).toFixed(2)} ms`}
              </text>
            </g>
          );
        })}
        {/* Legend */}
        <rect x={100} y={chartHeight - 30} width={20} height={15} fill="#dea584" rx={2} />
        <text x={125} y={chartHeight - 18} fontSize={12} fill="#374151">@veaba/qrcode-rust</text>
        <rect x={280} y={chartHeight - 30} width={20} height={15} fill="#6b7280" rx={2} />
        <text x={305} y={chartHeight - 18} fontSize={12} fill="#374151">kennytm-qrcode</text>
      </svg>
    </div>
  );
};

export const ErrorLevelChart = () => {
  const data = [
    { name: 'L (ä½)', veaba: 29.59, kennytm: 323.94 },
    { name: 'M (ä¸­)', veaba: 29.91, kennytm: 324.08 },
    { name: 'Q (è¾ƒé«˜)', veaba: 41.24, kennytm: 327.76 },
    { name: 'H (é«˜)', veaba: 42.46, kennytm: 491.10 },
  ];

  const maxTime = Math.max(...data.map(d => Math.max(d.veaba, d.kennytm)));

  return (
    <div style={{ marginBottom: '2rem' }}>
      <h3 style={{ textAlign: 'center', marginBottom: '1rem' }}>ä¸åŒçº é”™çº§åˆ«æ€§èƒ½ (Âµs/op)</h3>
      <div style={{ display: 'flex', alignItems: 'flex-end', justifyContent: 'center', gap: '3rem', height: '250px', padding: '1rem' }}>
        {data.map((item) => (
          <div key={item.name} style={{ display: 'flex', flexDirection: 'column', alignItems: 'center' }}>
            <div style={{ display: 'flex', gap: '8px', alignItems: 'flex-end', height: '180px' }}>
              {/* @veaba bar */}
              <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center' }}>
                <div style={{ fontSize: '11px', marginBottom: '0.25rem', color: '#dea584', fontWeight: 600 }}>
                  {item.veaba.toFixed(1)}
                </div>
                <div
                  style={{
                    width: '40px',
                    height: `${(item.veaba / maxTime) * 150}px`,
                    backgroundColor: '#dea584',
                    borderRadius: '4px 4px 0 0',
                    transition: 'height 0.3s ease'
                  }}
                />
              </div>
              {/* kennytm bar */}
              <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center' }}>
                <div style={{ fontSize: '11px', marginBottom: '0.25rem', color: '#6b7280', fontWeight: 600 }}>
                  {item.kennytm.toFixed(1)}
                </div>
                <div
                  style={{
                    width: '40px',
                    height: `${(item.kennytm / maxTime) * 150}px`,
                    backgroundColor: '#6b7280',
                    borderRadius: '4px 4px 0 0',
                    transition: 'height 0.3s ease'
                  }}
                />
              </div>
            </div>
            <div style={{ marginTop: '0.5rem', fontSize: '14px', fontWeight: 500 }}>
              {item.name}
            </div>
          </div>
        ))}
      </div>
      <div style={{ display: 'flex', justifyContent: 'center', gap: '2rem', marginTop: '0.5rem' }}>
        <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
          <div style={{ width: '16px', height: '16px', backgroundColor: '#dea584', borderRadius: '2px' }} />
          <span style={{ fontSize: '12px' }}>@veaba/qrcode-rust</span>
        </div>
        <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
          <div style={{ width: '16px', height: '16px', backgroundColor: '#6b7280', borderRadius: '2px' }} />
          <span style={{ fontSize: '12px' }}>kennytm-qrcode</span>
        </div>
      </div>
    </div>
  );
};

export const FeatureComparisonTable = () => {
  const features = [
    { name: 'SVG è¾“å‡º', veaba: true, kennytm: true },
    { name: 'PNG è¾“å‡º', veaba: true, kennytm: true },
    { name: 'å­—ç¬¦ä¸²è¾“å‡º', veaba: true, kennytm: true },
    { name: 'è‡ªå®šä¹‰æ ·å¼', veaba: 'å®Œæ•´', kennytm: 'æœ‰é™' },
    { name: 'çº é”™çº§åˆ« L/M/Q/H', veaba: true, kennytm: true },
    { name: 'å¼‚æ­¥æ”¯æŒ', veaba: true, kennytm: false },
    { name: 'WASM æ”¯æŒ', veaba: true, kennytm: false },
    { name: 'Node.js ç»‘å®š', veaba: 'è®¡åˆ’ä¸­', kennytm: false },
    { name: 'æ€§èƒ½ä¼˜åŒ–', veaba: 'ä¼˜ç§€', kennytm: 'è‰¯å¥½' },
  ];

  return (
    <table style={{ width: '100%', borderCollapse: 'collapse', marginTop: '1rem' }}>
      <thead>
        <tr style={{ backgroundColor: '#f3f4f6' }}>
          <th style={{ padding: '12px', textAlign: 'left', borderBottom: '2px solid #e5e7eb' }}>åŠŸèƒ½</th>
          <th style={{ padding: '12px', textAlign: 'center', borderBottom: '2px solid #e5e7eb' }}>@veaba/qrcode-rust</th>
          <th style={{ padding: '12px', textAlign: 'center', borderBottom: '2px solid #e5e7eb' }}>kennytm-qrcode</th>
        </tr>
      </thead>
      <tbody>
        {features.map((f, i) => (
          <tr key={f.name} style={{ backgroundColor: i % 2 === 0 ? 'white' : '#f9fafb' }}>
            <td style={{ padding: '12px', borderBottom: '1px solid #e5e7eb' }}>{f.name}</td>
            <td style={{ padding: '12px', textAlign: 'center', borderBottom: '1px solid #e5e7eb' }}>
              {typeof f.veaba === 'boolean' ? (
                f.veaba ? <span style={{ color: '#22c55e', fontSize: '20px' }}>âœ“</span> : <span style={{ color: '#ef4444' }}>âœ—</span>
              ) : (
                <span style={{ color: f.veaba === 'å®Œæ•´' || f.veaba === 'ä¼˜ç§€' ? '#22c55e' : '#f59e0b', fontWeight: 500 }}>{f.veaba}</span>
              )}
            </td>
            <td style={{ padding: '12px', textAlign: 'center', borderBottom: '1px solid #e5e7eb' }}>
              {typeof f.kennytm === 'boolean' ? (
                f.kennytm ? <span style={{ color: '#22c55e', fontSize: '20px' }}>âœ“</span> : <span style={{ color: '#ef4444' }}>âœ—</span>
              ) : (
                <span style={{ color: '#f59e0b', fontWeight: 500 }}>{f.kennytm}</span>
              )}
            </td>
          </tr>
        ))}
      </tbody>
    </table>
  );
};

export const SpeedupCard = () => {
  const speedups = [
    { test: 'å•æ¡ç”Ÿæˆ', factor: '8.4x' },
    { test: 'æ‰¹é‡ 100 æ¡', factor: '8.1x' },
    { test: 'çº é”™çº§åˆ« L', factor: '10.9x' },
    { test: 'çº é”™çº§åˆ« H', factor: '11.6x' },
  ];

  return (
    <div style={{ padding: '1.5rem', backgroundColor: '#f8fafc', borderRadius: '8px', marginTop: '1.5rem' }}>
      <h3 style={{ marginTop: 0 }}>ğŸš€ æ€§èƒ½æå‡å€æ•°</h3>
      <p style={{ color: '#64748b', marginBottom: '1rem' }}>@veaba/qrcode-rust ç›¸å¯¹äº kennytm-qrcode çš„æ€§èƒ½æå‡ï¼š</p>
      
      <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(150px, 1fr))', gap: '1rem' }}>
        {speedups.map((item) => (
          <div
            key={item.test}
            style={{
              padding: '1rem',
              backgroundColor: '#dcfce7',
              borderRadius: '8px',
              textAlign: 'center',
              border: '2px solid #22c55e'
            }}
          >
            <div style={{ fontSize: '24px', fontWeight: 'bold', color: '#166534' }}>{item.factor}</div>
            <div style={{ fontSize: '12px', color: '#64748b', marginTop: '0.25rem' }}>{item.test}</div>
          </div>
        ))}
      </div>
    </div>
  );
};

## æµ‹è¯•ç¯å¢ƒ

- **å¹³å°**: Windows
- **Rust**: rustc 1.89.0
- **æµ‹è¯•æ—¶é—´**: 2026-02-02

## æ¯”è¾ƒçš„åŒ…

- `@veaba/qrcode-rust` - æœ¬é¡¹ç›® Rust å®ç°
- `kennytm-qrcode` - æµè¡Œçš„ Rust QRCode åº“ï¼ˆä½œä¸ºåŸºå‡†ï¼‰

---

## ğŸ“Š æ€§èƒ½å¯è§†åŒ–

### æ€§èƒ½å¯¹æ¯”

<RustBenchmarkChart />

### ä¸åŒçº é”™çº§åˆ«æ€§èƒ½

<ErrorLevelChart />

---

## ğŸš€ æ€§èƒ½æå‡

<SpeedupCard />

---

## ğŸ“‹ åŠŸèƒ½å¯¹æ¯”

<FeatureComparisonTable />

---

## æ€§èƒ½æµ‹è¯•ç»“æœ

### @veaba/qrcode-rust vs kennytm-qrcode

åŸºäº `criterion` åŸºå‡†æµ‹è¯•æ¡†æ¶çš„æœ€æ–°ç»“æœï¼ˆ2026-02-02ï¼‰ï¼š

| æµ‹è¯•é¡¹ | @veaba/qrcode-rust | kennytm-qrcode | é€Ÿåº¦æå‡ |
|--------|-------------------|----------------|----------|
| å•æ¡ç”Ÿæˆ | ~54.4 Âµs | ~454.6 Âµs | **8.4x** |
| æ‰¹é‡ç”Ÿæˆ (100æ¡) | ~4.21 ms | ~34.12 ms | **8.1x** |
| SVG ç”Ÿæˆ | ~35.9 Âµs | ~4.1 Âµs | 0.1x* |
| çº é”™çº§åˆ« L | ~29.6 Âµs | ~323.9 Âµs | **10.9x** |
| çº é”™çº§åˆ« M | ~29.9 Âµs | ~324.1 Âµs | **10.8x** |
| çº é”™çº§åˆ« Q | ~41.2 Âµs | ~327.8 Âµs | **8.0x** |
| çº é”™çº§åˆ« H | ~42.5 Âµs | ~491.1 Âµs | **11.6x** |

*æ³¨ï¼škennytm-qrcode çš„ SVG ç”Ÿæˆä½¿ç”¨äº†ä¸åŒçš„æ¸²æŸ“æ–¹å¼ï¼Œç›´æ¥è¾“å‡ºå­—ç¬¦è€Œä¸æ˜¯ SVG XMLï¼Œæ‰€ä»¥çœ‹èµ·æ¥æ›´å¿«ï¼Œä½†åŠŸèƒ½ä¸åŒ

### æ–‡æœ¬é•¿åº¦å¯¹æ¯”

| æ–‡æœ¬é•¿åº¦ | @veaba/qrcode-rust | kennytm-qrcode | é€Ÿåº¦æå‡ |
|----------|-------------------|----------------|----------|
| çŸ­æ–‡æœ¬ (12 chars) | ~31.8 Âµs | ~204.2 Âµs | **6.4x** |
| ä¸­ç­‰æ–‡æœ¬ (36 chars) | ~53.6 Âµs | ~471.6 Âµs | **8.8x** |
| é•¿æ–‡æœ¬ (98 chars) | ~145.1 Âµs | ~1050.9 Âµs | **7.2x** |

## éªŒè¯ç»“æœ

ä½¿ç”¨ `rust-tools` éªŒè¯å·¥å…·å¯¹ç”Ÿæˆçš„ SVG è¿›è¡ŒéªŒè¯ï¼š

```bash
# ç”Ÿæˆå¹¶éªŒè¯äºŒç»´ç 
cargo run --release --features validation --bin veaba-qr -- "Hello World"

# è¾“å‡ºï¼š
# ğŸ“¦ @veaba/qrcode-rust
# âœ… éªŒè¯é€šè¿‡ï¼
# 
# ğŸ“¦ @veaba/qrcode-fast  
# âš ï¸  éªŒè¯å¤±è´¥ (é¢„æœŸ) - qrcode-fast æ˜¯ç®€åŒ–å®ç°ï¼Œä»…ç”¨äºæ€§èƒ½æµ‹è¯•
```

**éªŒè¯ç»“è®º**: 
- `@veaba/qrcode-rust` ç”Ÿæˆçš„äºŒç»´ç  SVG å¯ä»¥é€šè¿‡æ ‡å‡†äºŒç»´ç æ‰«æå™¨æ­£ç¡®è§£ç ï¼Œå†…å®¹åŒ¹é…
- `@veaba/qrcode-fast` ç°åœ¨ä¹Ÿå·²å®ç°å®Œæ•´çš„ QR ç ç”Ÿæˆé€»è¾‘ï¼Œç”Ÿæˆçš„äºŒç»´ç å¯æ­£ç¡®è§£ç 

## ä½¿ç”¨å»ºè®®

| åœºæ™¯ | æ¨èåŒ… | åŸå›  |
|------|--------|------|
| é€šç”¨åœºæ™¯ | `@veaba/qrcode-rust` | åŠŸèƒ½å®Œæ•´ï¼Œæ€§èƒ½ä¼˜ç§€ï¼Œæ¯” kennytm å¿« 8-10 å€ |
| æè‡´æ€§èƒ½ | `@veaba/qrcode-fast` | é’ˆå¯¹æ€§èƒ½ä¼˜åŒ–ï¼ˆæ³¨æ„ï¼šç”Ÿæˆä¼ªæ•°æ®ï¼Œä»…ç”¨äºåŸºå‡†æµ‹è¯•ï¼‰ |
| å…¼å®¹æ€§ä¼˜å…ˆ | `kennytm-qrcode` | ç¤¾åŒºæˆç†Ÿï¼Œæ–‡æ¡£ä¸°å¯Œ |
| WASM åœºæ™¯ | `@veaba/qrcode-rust` | å†…ç½® WASM æ”¯æŒ |

## è¿è¡ŒåŸºå‡†æµ‹è¯•

```bash
# è¿è¡Œ Rust åŸºå‡†æµ‹è¯•
cd packages/qrcode-rust
cargo bench --bench comparison_bench

# æŸ¥çœ‹è¯¦ç»†æŠ¥å‘Š
target/criterion/report/index.html

# ä½¿ç”¨ rust-tools éªŒè¯ç”Ÿæˆçš„ SVG
cd bench/rust-tools
cargo run --release --features validation --bin veaba-qr -- "ä½ çš„æ–‡æœ¬"
```

## è¯¦ç»†æŠ¥å‘Šä½ç½®

åŸºå‡†æµ‹è¯•çš„è¯¦ç»†æŠ¥å‘Šç”Ÿæˆåœ¨ï¼š
- `target/criterion/` - Criterion åŸºå‡†æµ‹è¯•æŠ¥å‘Š

å¯ä»¥ä½¿ç”¨æµè§ˆå™¨æ‰“å¼€æŸ¥çœ‹å›¾è¡¨å’Œè¯¦ç»†åˆ†æï¼š
```bash
# åœ¨ Windows ä¸Š
start target/criterion/report/index.html
```

## æŠ€æœ¯ç»†èŠ‚

### æµ‹è¯•æ–¹æ³•

ä½¿ç”¨ Criterion.rs è¿›è¡ŒåŸºå‡†æµ‹è¯•ï¼š
- é¢„çƒ­æ—¶é—´: 3 ç§’
- é‡‡æ ·æ¬¡æ•°: 100 æ¬¡
- æµ‹é‡æ—¶é—´: çº¦ 5 ç§’/æµ‹è¯•

### æµ‹è¯•æ•°æ®

- çŸ­æ–‡æœ¬: `"https://a.co"` (12 å­—ç¬¦)
- ä¸­ç­‰æ–‡æœ¬: `"https://github.com/veaba/qrcodes"` (36 å­—ç¬¦)
- é•¿æ–‡æœ¬: åŒ…å«å¤šä¸ªå‚æ•°çš„ URL (98 å­—ç¬¦)

### SVG éªŒè¯å·¥å…·

ä½äº `bench/rust-tools`ï¼Œæä¾›ä»¥ä¸‹åŠŸèƒ½ï¼š
- `veaba-qr` - ç”Ÿæˆå¹¶éªŒè¯äºŒç»´ç 
- `test-svgs` - æµ‹è¯•ç°æœ‰ SVG æ–‡ä»¶
- `validate-qr` - éªŒè¯ kennytm ç”Ÿæˆçš„äºŒç»´ç 

---

*æ•°æ®æ–‡ä»¶*: [backend_benchmark_pk.json](/backend_benchmark_pk.json) | [backend_benchmark_pk_summary.json](/backend_benchmark_pk_summary.json)

*æµ‹è¯•ä»£ç *: `packages/qrcode-rust/benches/comparison_bench.rs`

*æœ€åæ›´æ–°*: 2026-02-02

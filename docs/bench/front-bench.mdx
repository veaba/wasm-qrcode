# å‰ç«¯åŸºå‡†æµ‹è¯•æŠ¥å‘Š

import { useState } from 'react';

export const FeatureComparison = () => {
  const features = [
    { name: 'çº¯ TypeScript å®ç°', js: true, wasm: true },
    { name: 'æ— éœ€ WASM æ–‡ä»¶', js: true, wasm: false },
    { name: 'åŒ…ä½“ç§¯è¾ƒå°', js: true, wasm: false },
    { name: 'å¯åŠ¨é€Ÿåº¦å¿«', js: true, wasm: false },
    { name: 'WASM æ€§èƒ½ä¼˜åŠ¿', js: false, wasm: true },
    { name: 'é€‚åˆå¤§é‡ç”Ÿæˆ', js: false, wasm: true },
    { name: 'æµè§ˆå™¨å…¼å®¹æ€§', js: 'ä¼˜ç§€', wasm: 'è‰¯å¥½' },
    { name: 'SVG è¾“å‡º', js: true, wasm: true },
    { name: 'DataURL è¾“å‡º', js: true, wasm: true },
    { name: 'è‡ªå®šä¹‰æ ·å¼', js: true, wasm: true },
  ];

  return (
    <table style={{ width: '100%', borderCollapse: 'collapse', marginTop: '1rem' }}>
      <thead>
        <tr style={{ backgroundColor: '#f3f4f6' }}>
          <th style={{ padding: '12px', textAlign: 'left', borderBottom: '2px solid #e5e7eb' }}>ç‰¹æ€§</th>
          <th style={{ padding: '12px', textAlign: 'center', borderBottom: '2px solid #e5e7eb' }}>@veaba/qrcode-js</th>
          <th style={{ padding: '12px', textAlign: 'center', borderBottom: '2px solid #e5e7eb' }}>@veaba/qrcode-wasm</th>
        </tr>
      </thead>
      <tbody>
        {features.map((f, i) => (
          <tr key={f.name} style={{ backgroundColor: i % 2 === 0 ? 'white' : '#f9fafb' }}>
            <td style={{ padding: '12px', borderBottom: '1px solid #e5e7eb' }}>{f.name}</td>
            <td style={{ padding: '12px', textAlign: 'center', borderBottom: '1px solid #e5e7eb' }}>
              {typeof f.js === 'boolean' ? (
                f.js ? <span style={{ color: '#22c55e', fontSize: '20px' }}>âœ“</span> : <span style={{ color: '#ef4444' }}>âœ—</span>
              ) : (
                <span style={{ color: '#f59e0b', fontWeight: 500 }}>{f.js}</span>
              )}
            </td>
            <td style={{ padding: '12px', textAlign: 'center', borderBottom: '1px solid #e5e7eb' }}>
              {typeof f.wasm === 'boolean' ? (
                f.wasm ? <span style={{ color: '#22c55e', fontSize: '20px' }}>âœ“</span> : <span style={{ color: '#ef4444' }}>âœ—</span>
              ) : (
                <span style={{ color: '#f59e0b', fontWeight: 500 }}>{f.wasm}</span>
              )}
            </td>
          </tr>
        ))}
      </tbody>
    </table>
  );
};

export const ScenarioSelector = () => {
  const [scenario, setScenario] = useState('simple');
  
  const scenarios = {
    simple: {
      title: 'ç®€å•åº”ç”¨',
      recommended: '@veaba/qrcode-js',
      reason: 'åŒ…ä½“ç§¯å°ï¼ŒåŠ è½½å¿«ï¼Œé€‚åˆç®€å•çš„ QRCode ç”Ÿæˆéœ€æ±‚',
      color: '#22c55e'
    },
    batch: {
      title: 'å¤§é‡ç”Ÿæˆ',
      recommended: '@veaba/qrcode-wasm',
      reason: 'WASM æ€§èƒ½ä¼˜åŠ¿æ˜æ˜¾ï¼Œé€‚åˆéœ€è¦ç”Ÿæˆå¤§é‡ QRCode çš„åœºæ™¯',
      color: '#3b82f6'
    },
    firstPaint: {
      title: 'é¦–å±åŠ è½½æ•æ„Ÿ',
      recommended: '@veaba/qrcode-js',
      reason: 'æ— éœ€ç­‰å¾… WASM åŠ è½½ï¼Œå¯ä»¥ç«‹å³å¼€å§‹ç”Ÿæˆ QRCode',
      color: '#22c55e'
    },
    complex: {
      title: 'å¤æ‚åº”ç”¨',
      recommended: 'ä¸¤è€…çš†å¯',
      reason: 'æ ¹æ®å…·ä½“éœ€æ±‚é€‰æ‹©ï¼Œéœ€è¦æ€§èƒ½é€‰ WASMï¼Œéœ€è¦å¿«é€Ÿå¯åŠ¨é€‰ JS',
      color: '#f59e0b'
    }
  };

  const current = scenarios[scenario];

  return (
    <div style={{ padding: '1.5rem', backgroundColor: '#f8fafc', borderRadius: '8px', marginTop: '1.5rem' }}>
      <h3 style={{ marginTop: 0 }}>ğŸ¯ åœºæ™¯é€‰æ‹©å™¨</h3>
      
      <div style={{ display: 'flex', gap: '0.5rem', marginBottom: '1.5rem', flexWrap: 'wrap' }}>
        {Object.entries(scenarios).map(([key, s]) => (
          <button
            key={key}
            onClick={() => setScenario(key)}
            style={{
              padding: '0.5rem 1rem',
              borderRadius: '6px',
              border: 'none',
              cursor: 'pointer',
              backgroundColor: scenario === key ? '#3b82f6' : '#e2e8f0',
              color: scenario === key ? 'white' : '#475569',
              fontWeight: scenario === key ? 600 : 400,
              transition: 'all 0.2s'
            }}
          >
            {s.title}
          </button>
        ))}
      </div>

      <div style={{ 
        padding: '1.5rem', 
        backgroundColor: 'white', 
        borderRadius: '8px',
        borderLeft: `4px solid ${current.color}`
      }}>
        <div style={{ fontSize: '14px', color: '#64748b', marginBottom: '0.5rem' }}>æ¨èé€‰æ‹©</div>
        <div style={{ fontSize: '24px', fontWeight: 'bold', color: current.color, marginBottom: '0.5rem' }}>
          {current.recommended}
        </div>
        <div style={{ fontSize: '14px', color: '#475569', lineHeight: 1.6 }}>
          {current.reason}
        </div>
      </div>
    </div>
  );
};

export const BundleSizeVisualizer = () => {
  const jsSize = 15; // KB
  const wasmSize = 45; // KB (including WASM file)
  const maxSize = Math.max(jsSize, wasmSize);

  return (
    <div style={{ padding: '1.5rem', backgroundColor: '#f8fafc', borderRadius: '8px', marginTop: '1.5rem' }}>
      <h3 style={{ marginTop: 0 }}>ğŸ“¦ åŒ…ä½“ç§¯å¯¹æ¯”</h3>
      
      <div style={{ marginBottom: '1.5rem' }}>
        <div style={{ display: 'flex', alignItems: 'center', marginBottom: '0.5rem' }}>
          <span style={{ width: '150px', fontSize: '14px' }}>@veaba/qrcode-js</span>
          <div style={{ flex: 1, height: '30px', backgroundColor: '#e2e8f0', borderRadius: '4px', overflow: 'hidden' }}>
            <div style={{ 
              width: `${(jsSize / maxSize) * 100}%`, 
              height: '100%', 
              backgroundColor: '#22c55e',
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'flex-end',
              paddingRight: '8px',
              color: 'white',
              fontSize: '12px',
              fontWeight: 600
            }}>
              ~{jsSize} KB
            </div>
          </div>
        </div>
        
        <div style={{ display: 'flex', alignItems: 'center' }}>
          <span style={{ width: '150px', fontSize: '14px' }}>@veaba/qrcode-wasm</span>
          <div style={{ flex: 1, height: '30px', backgroundColor: '#e2e8f0', borderRadius: '4px', overflow: 'hidden' }}>
            <div style={{ 
              width: `${(wasmSize / maxSize) * 100}%`, 
              height: '100%', 
              backgroundColor: '#3b82f6',
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'flex-end',
              paddingRight: '8px',
              color: 'white',
              fontSize: '12px',
              fontWeight: 600
            }}>
              ~{wasmSize} KB
            </div>
          </div>
        </div>
      </div>

      <div style={{ fontSize: '13px', color: '#64748b' }}>
        * ä¼°ç®—å€¼ï¼Œå®é™…å¤§å°å¯èƒ½å› æ„å»ºé…ç½®è€Œå¼‚ã€‚WASM ç‰ˆæœ¬åŒ…å« WASM äºŒè¿›åˆ¶æ–‡ä»¶ã€‚
      </div>
    </div>
  );
};

## æµ‹è¯•ç¯å¢ƒ

- **å¹³å°**: Windows
- **æµè§ˆå™¨**: é€šè¿‡ Vitest Browser æ¨¡å¼æµ‹è¯•
- **æµ‹è¯•æ—¶é—´**: 2026-02-01

## æµ‹è¯•åŒ…

- `@veaba/qrcode-js` - TypeScript å®ç°ï¼Œé€‚ç”¨äºæµè§ˆå™¨
- `@veaba/qrcode-wasm` - Rust WASM å®ç°ï¼Œé€‚ç”¨äºæµè§ˆå™¨

---

## ğŸ¯ åœºæ™¯é€‰æ‹©å™¨

ä¸çŸ¥é“é€‰å“ªä¸ªï¼Ÿä½¿ç”¨ä¸‹é¢çš„åœºæ™¯é€‰æ‹©å™¨ï¼š

<ScenarioSelector />

---

## ğŸ“Š ç‰¹æ€§å¯¹æ¯”

<FeatureComparison />

---

## ğŸ“¦ åŒ…ä½“ç§¯å¯¹æ¯”

<BundleSizeVisualizer />

---

## API å…¼å®¹æ€§

`@veaba/qrcode-js` å’Œ `@veaba/qrcode-wasm` æä¾›å®Œå…¨ç›¸åŒçš„ APIï¼š

```typescript
// ä¸¤è€…éƒ½æ”¯æŒç›¸åŒçš„æ¥å£
import { QRCode } from '@veaba/qrcode-js'; // æˆ– '@veaba/qrcode-wasm'

const qr = new QRCode('https://example.com');
const svg = qr.toSVG();
const dataURL = qr.toDataURL();
```

## æ€§èƒ½ç‰¹ç‚¹

### @veaba/qrcode-js

- **ä¼˜ç‚¹**: 
  - çº¯ TypeScript å®ç°ï¼Œæ— éœ€é¢å¤–åŠ è½½ WASM æ–‡ä»¶
  - åŒ…ä½“ç§¯è¾ƒå° (~15 KB)
  - å¯åŠ¨é€Ÿåº¦å¿«
  - å…¼å®¹æ€§æ›´å¥½

- **é€‚ç”¨åœºæ™¯**:
  - å¯¹åŒ…ä½“ç§¯æ•æ„Ÿçš„åº”ç”¨
  - éœ€è¦å¿«é€Ÿå¯åŠ¨çš„åœºæ™¯
  - ç®€å•çš„ QRCode ç”Ÿæˆéœ€æ±‚

### @veaba/qrcode-wasm

- **ä¼˜ç‚¹**:
  - Rust å®ç°ï¼Œç†è®ºä¸Šæ€§èƒ½æ›´å¥½
  - é€‚åˆå¤§é‡ QRCode ç”Ÿæˆåœºæ™¯

- **æ³¨æ„äº‹é¡¹**:
  - éœ€è¦åŠ è½½ WASM æ–‡ä»¶ (~45 KB æ€»è®¡)
  - é¦–æ¬¡åŠ è½½å¯èƒ½æœ‰å»¶è¿Ÿ

## ä½¿ç”¨å»ºè®®

| åœºæ™¯ | æ¨èåŒ… | åŸå›  |
|------|--------|------|
| ç®€å•åº”ç”¨ | `@veaba/qrcode-js` | ä½“ç§¯å°ï¼ŒåŠ è½½å¿« |
| å¤§é‡ç”Ÿæˆ | `@veaba/qrcode-wasm` | WASM æ€§èƒ½ä¼˜åŠ¿ |
| é¦–å±åŠ è½½ | `@veaba/qrcode-js` | æ— éœ€ç­‰å¾… WASM åŠ è½½ |
| å¤æ‚åº”ç”¨ | ä¸¤è€…çš†å¯ | æ ¹æ®å…·ä½“éœ€æ±‚é€‰æ‹© |

## æµ‹è¯•è¿è¡Œæ–¹å¼

```bash
# è¿è¡Œå‰ç«¯æµ‹è¯•
pnpm run test:browser

# è¿è¡Œå•å…ƒæµ‹è¯•
pnpm run test:unit
```

## åŸºå‡†æµ‹è¯•æ•°æ®

> æ³¨ï¼šå‰ç«¯åŸºå‡†æµ‹è¯•æ•°æ®é€šè¿‡æµè§ˆå™¨ç¯å¢ƒè·å–ï¼Œå®é™…æ€§èƒ½ä¼šå› è®¾å¤‡å’Œæµè§ˆå™¨ç‰ˆæœ¬è€Œå¼‚ã€‚

### æµ‹è¯•åœºæ™¯

1. **å•æ¡ QRCode ç”Ÿæˆ** - æµ‹è¯•ä¸åŒé•¿åº¦æ–‡æœ¬çš„ç”Ÿæˆæ€§èƒ½
2. **æ‰¹é‡ QRCode ç”Ÿæˆ** - æµ‹è¯•åŒæ—¶ç”Ÿæˆå¤šä¸ª QRCode çš„æ€§èƒ½
3. **SVG è¾“å‡º** - æµ‹è¯•ç”Ÿæˆ SVG æ ¼å¼çš„æ—¶é—´
4. **DataURL è¾“å‡º** - æµ‹è¯•ç”Ÿæˆ DataURL æ ¼å¼çš„æ—¶é—´
5. **çº é”™çº§åˆ«** - æµ‹è¯•ä¸åŒçº é”™çº§åˆ«ä¸‹çš„æ€§èƒ½

### æ¨èé…ç½®

```javascript
// vite.config.js æˆ–ç±»ä¼¼é…ç½®
export default {
  optimizeDeps: {
    include: ['@veaba/qrcode-js']
  },
  // å¯¹äº WASM ç‰ˆæœ¬ï¼Œéœ€è¦é…ç½® wasm åŠ è½½
  server: {
    fs: {
      allow: ['..']
    }
  }
}
```

---

*æ³¨æ„*: è¯¦ç»†çš„æ€§èƒ½æ•°æ®éœ€è¦é€šè¿‡æµè§ˆå™¨å®é™…æµ‹è¯•è·å–ã€‚å»ºè®®ä½¿ç”¨ Chrome DevTools çš„ Performance é¢æ¿è¿›è¡Œæ›´è¯¦ç»†çš„æ€§èƒ½åˆ†æã€‚
